<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capsule Wardrobe Planner</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Crimson+Pro:wght@300;400;600&display=swap');
        
        :root {
            --pink: #ff6b9d;
            --teal: #4ecdc4;
            --purple: #a78bfa;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --cream: #fef6e4;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Mono', monospace;
            background: linear-gradient(135deg, var(--cream) 0%, #fff 100%);
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 3px solid var(--dark);
            margin-bottom: 40px;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 3rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
            letter-spacing: -1px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        nav {
            display: flex;
            justify-content: center;
            gap: 0;
            margin: 30px 0;
            border: 2px solid var(--dark);
            background: white;
            overflow: hidden;
        }
        
        nav button {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            border-right: 2px solid var(--dark);
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        nav button:last-child {
            border-right: none;
        }
        
        nav button:hover {
            background: var(--cream);
        }
        
        nav button.active {
            background: var(--dark);
            color: white;
        }
        
        nav button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--pink);
        }
        
        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border: 2px solid var(--dark);
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.1);
        }
        
        .card h2 {
            font-family: 'Crimson Pro', serif;
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .card p {
            color: var(--gray);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        select, input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--dark);
            background: white;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--pink);
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .color-swatch {
            aspect-ratio: 1;
            border: 2px solid var(--dark);
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: flex-end;
            padding: 10px;
            position: relative;
        }
        
        .color-swatch:hover {
            transform: translateY(-4px);
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }
        
        .color-swatch.selected {
            border-width: 4px;
            border-color: var(--dark);
            transform: translateY(-4px);
        }
        
        .color-swatch.selected::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            background: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border: 2px solid var(--dark);
        }
        
        .color-name {
            font-size: 0.75rem;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 2px;
            font-weight: 700;
        }
        
        .custom-colors {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px dashed var(--gray);
        }
        
        .custom-color-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .custom-color-input input[type="text"] {
            flex: 1;
        }
        
        .custom-color-input input[type="color"] {
            width: 60px;
            height: 44px;
            border: 2px solid var(--dark);
            cursor: pointer;
        }
        
        button.primary {
            background: var(--pink);
            color: white;
            border: 2px solid var(--dark);
            padding: 15px 30px;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 0 var(--dark);
        }
        
        button.primary:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--dark);
        }
        
        button.primary:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0 var(--dark);
        }
        
        button.secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--dark);
            padding: 12px 24px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        button.secondary:hover {
            background: var(--teal);
            color: white;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .selected-colors-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
            background: var(--cream);
            border: 2px dashed var(--dark);
        }
        
        .selected-color-chip {
            padding: 8px 16px;
            border: 2px solid var(--dark);
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
        }
        
        .selected-color-chip .color-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid var(--dark);
        }
        
        .remove-color {
            cursor: pointer;
            font-weight: 700;
            margin-left: 4px;
        }
        
        .remove-color:hover {
            color: var(--pink);
        }
        
        .info-box {
            background: rgba(78, 205, 196, 0.1);
            border-left: 4px solid var(--teal);
            padding: 15px;
            margin: 20px 0;
            font-size: 0.85rem;
        }
        
        .placeholder {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
            font-style: italic;
        }
        
        .activity-card {
            border: 2px solid var(--dark);
            padding: 20px;
            margin-bottom: 15px;
            background: white;
            position: relative;
            transition: transform 0.2s ease;
        }
        
        .activity-card:hover {
            transform: translateX(4px);
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .activity-date {
            font-weight: 700;
            color: var(--pink);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .activity-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            transition: transform 0.2s ease;
        }
        
        .icon-button:hover {
            transform: scale(1.2);
        }
        
        .icon-button.delete:hover {
            color: var(--pink);
        }
        
        .activity-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .activity-location {
            color: var(--teal);
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .activity-badge {
            display: inline-block;
            padding: 6px 12px;
            background: var(--purple);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 3px;
            margin-bottom: 10px;
        }
        
        .activity-badge.formal {
            background: var(--dark);
        }
        
        .activity-badge.activewear {
            background: var(--pink);
        }
        
        .activity-badge.beach {
            background: var(--teal);
        }
        
        .activity-badge.dressy-casual {
            background: var(--purple);
        }
        
        .activity-notes {
            color: var(--gray);
            font-size: 0.85rem;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--gray);
        }
        
        .trip-summary {
            background: var(--cream);
            border: 2px solid var(--dark);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .trip-summary h3 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .trip-summary p {
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--gray);
            font-style: italic;
            border: 2px dashed var(--gray);
            background: var(--cream);
        }
        
        .date-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .date-cell {
            aspect-ratio: 1;
            border: 2px solid var(--dark);
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
        }
        
        .date-cell:hover {
            background: var(--cream);
        }
        
        .date-cell.selected {
            background: var(--pink);
            color: white;
            font-weight: 700;
        }
        
        .date-cell.disabled {
            background: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
            border-color: #ddd;
        }
        
        .date-cell .day-num {
            font-weight: 700;
            font-size: 1rem;
        }
        
        .date-cell .day-name {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 20px;
        }
        
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: white;
            border: 2px solid var(--dark);
            font-size: 0.85rem;
            font-weight: 700;
        }
        
        .tag .remove-tag {
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            line-height: 1;
            color: var(--pink);
        }
        
        .tag .remove-tag:hover {
            color: var(--dark);
        }
        
        .wardrobe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .wardrobe-item {
            border: 2px solid var(--dark);
            background: white;
            overflow: hidden;
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .wardrobe-item:hover {
            transform: translateY(-4px);
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }
        
        .wardrobe-item-photo {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            background: var(--cream);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 3rem;
        }
        
        .wardrobe-item-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .wardrobe-item-info {
            padding: 15px;
        }
        
        .wardrobe-item-name {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .wardrobe-item-type {
            font-size: 0.75rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .wardrobe-item-colors {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }
        
        .wardrobe-color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid var(--dark);
        }
        
        .wardrobe-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--cream);
        }
        
        .wardrobe-item-actions button {
            flex: 1;
            padding: 6px;
            background: white;
            border: 1px solid var(--dark);
            cursor: pointer;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            transition: background 0.2s ease;
        }
        
        .wardrobe-item-actions button:hover {
            background: var(--cream);
        }
        
        .wardrobe-item-actions button.delete:hover {
            background: var(--pink);
            color: white;
        }
        
        .photo-preview {
            margin-top: 10px;
            position: relative;
            display: inline-block;
        }
        
        .photo-preview img {
            max-width: 200px;
            max-height: 200px;
            border: 2px solid var(--dark);
        }
        
        .photo-preview .remove-preview {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--pink);
            color: white;
            border: 2px solid var(--dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .photo-preview .remove-preview:hover {
            background: var(--dark);
        }
        
        input[type="file"] {
            padding: 10px;
            cursor: pointer;
        }
        
        .empty-wardrobe {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
            font-style: italic;
            border: 2px dashed var(--gray);
            background: var(--cream);
        }
        
        .outfit-activity-card {
            border: 2px solid var(--dark);
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .outfit-activity-card:hover {
            transform: translateX(2px);
        }
        
        .outfit-activity-card.selected {
            border-color: var(--pink);
            border-width: 3px;
            background: rgba(255, 107, 157, 0.05);
        }
        
        .outfit-activity-header {
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--pink);
            margin-bottom: 5px;
        }
        
        .outfit-activity-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 8px;
        }
        
        .outfit-items-assigned {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--gray);
        }
        
        .outfit-items-assigned-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        .outfit-assigned-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            background: var(--cream);
            margin-bottom: 4px;
            font-size: 0.85rem;
        }
        
        .outfit-assigned-item .remove {
            margin-left: auto;
            cursor: pointer;
            color: var(--pink);
            font-weight: 700;
        }
        
        .outfit-assigned-item .remove:hover {
            color: var(--dark);
        }
        
        .outfit-wardrobe-item {
            border: 2px solid var(--dark);
            background: white;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            gap: 10px;
            padding: 10px;
            align-items: center;
        }
        
        .outfit-wardrobe-item:hover {
            transform: translateY(-2px);
            box-shadow: 2px 2px 0 rgba(0,0,0,0.2);
        }
        
        .outfit-wardrobe-item.assigned {
            opacity: 0.5;
        }
        
        .outfit-wardrobe-item-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border: 1px solid var(--dark);
            background: var(--cream);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .outfit-wardrobe-item-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .outfit-wardrobe-item-info {
            flex: 1;
        }
        
        .outfit-wardrobe-item-name {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }
        
        .outfit-wardrobe-item-type {
            font-size: 0.7rem;
            color: var(--gray);
            text-transform: uppercase;
        }
        
        .outfit-wardrobe-item-usage {
            font-size: 0.75rem;
            color: var(--teal);
            font-weight: 700;
        }
        
        .outfit-preview-item {
            text-align: center;
        }
        
        .outfit-preview-photo {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border: 2px solid var(--dark);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin-bottom: 8px;
        }
        
        .outfit-preview-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .outfit-preview-name {
            font-size: 0.8rem;
            font-weight: 700;
        }
        
        .all-outfits-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .outfit-group {
            border: 2px solid var(--dark);
            padding: 15px;
            background: white;
        }
        
        .outfit-group-header {
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: var(--pink);
        }
        
        .outfit-group-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .summary-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--cream);
        }
        
        .summary-label {
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }
        
        .summary-value {
            font-size: 0.9rem;
        }
        
        .daily-outfit-card {
            border: 2px solid var(--dark);
            padding: 20px;
            margin-bottom: 20px;
            background: white;
        }
        
        .daily-outfit-date {
            font-weight: 700;
            color: var(--pink);
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .daily-outfit-activity {
            font-family: 'Crimson Pro', serif;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .daily-outfit-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--gray);
        }
        
        .usage-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .usage-category {
            border: 2px solid var(--dark);
            padding: 15px;
            background: var(--cream);
        }
        
        .usage-category h4 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .usage-category ul {
            list-style: none;
            padding: 0;
        }
        
        .usage-category li {
            padding: 5px 0;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Capsule Wardrobe Planner</h1>
        <p class="subtitle">Build Your Perfect Travel Wardrobe</p>
    </header>
    
    <div class="container">
        <nav id="mainNav">
            <button class="active" data-step="color-story">Color Story</button>
            <button data-step="trip-planning">Trip Planning</button>
            <button data-step="wardrobe">Wardrobe</button>
            <button data-step="outfits">Outfits</button>
            <button data-step="export">Export</button>
        </nav>
        
        <!-- Step 1: Color Story -->
        <div id="color-story" class="step active">
            <div class="card">
                <h2>Define Your Color Story</h2>
                <p>Start by selecting a cohesive color palette for your capsule wardrobe. You can choose based on your color season, or create a custom palette.</p>
                
                <div class="form-group">
                    <label for="colorSeason">Color Season (Optional)</label>
                    <select id="colorSeason">
                        <option value="">-- Select a color season --</option>
                        <option value="cool-summer">Cool Summer</option>
                        <option value="warm-spring">Warm Spring</option>
                        <option value="soft-autumn">Soft Autumn</option>
                        <option value="deep-winter">Deep Winter</option>
                        <option value="clear-winter">Clear Winter</option>
                        <option value="warm-autumn">Warm Autumn</option>
                        <option value="clear-spring">Clear Spring</option>
                        <option value="soft-summer">Soft Summer</option>
                        <option value="deep-autumn">Deep Autumn</option>
                        <option value="cool-winter">Cool Winter</option>
                        <option value="light-spring">Light Spring</option>
                        <option value="light-summer">Light Summer</option>
                    </select>
                </div>
                
                <div id="seasonPalette" style="display: none;">
                    <div class="info-box">
                        <strong>Suggested colors for your season:</strong> Select the colors you want to include in your wardrobe.
                    </div>
                    <div id="seasonColors" class="color-palette"></div>
                </div>
                
                <div class="custom-colors">
                    <h3 style="font-family: 'Crimson Pro', serif; margin-bottom: 15px;">Add Custom Colors</h3>
                    <p style="color: var(--gray); font-size: 0.85rem; margin-bottom: 15px;">Add specific colors that aren't in the suggested palette, or skip the season selection entirely.</p>
                    
                    <div class="custom-color-input">
                        <input type="text" id="customColorName" placeholder="Color name">
                        <input type="color" id="customColorValue" value="#000000">
                        <button class="secondary" onclick="addCustomColor()">Add</button>
                    </div>
                    
                    <div id="customColorsList" class="color-palette" style="margin-top: 20px;"></div>
                </div>
                
                <div class="selected-colors-preview" id="selectedColorsPreview" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 10px;">
                        <strong>Your Color Story:</strong>
                        <button class="secondary" onclick="clearAllColors()" style="padding: 6px 12px; font-size: 0.75rem;">Clear All</button>
                    </div>
                    <div id="selectedColorsList"></div>
                </div>
                
                <div class="button-group">
                    <button class="primary" onclick="saveColorStory()">Save & Continue ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Trip Planning -->
        <div id="trip-planning" class="step">
            <div class="card">
                <h2>Trip Details</h2>
                <p>Add your trip destinations, dates, and daily activities to plan appropriate outfits.</p>
                
                <div class="form-group">
                    <label for="tripName">Trip Name</label>
                    <input type="text" id="tripName" placeholder="Birthday Weekend, Spring Break, Convention">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="tripStart">Start Date</label>
                        <input type="date" id="tripStart">
                    </div>
                    
                    <div class="form-group">
                        <label for="tripEnd">End Date</label>
                        <input type="date" id="tripEnd">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="tripNotes">Trip Notes (Optional)</label>
                    <textarea id="tripNotes" rows="3" placeholder="Any overall trip details, weather considerations, etc."></textarea>
                </div>
                
                <div class="button-group">
                    <button class="secondary" onclick="saveTripBasics()">Save Trip Info</button>
                </div>
            </div>
            
            <div class="card">
                <h2>Daily Activities</h2>
                <p>Add each day of your trip with activities and outfit requirements.</p>
                
                <form id="activityForm" onsubmit="addActivity(event)">
                    <div class="form-group">
                        <label for="activityDates">Date(s)</label>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 8px;">
                            Hold Ctrl/Cmd to select multiple dates
                        </div>
                        <div id="datePickerContainer"></div>
                        <div id="selectedDatesDisplay" style="margin-top: 10px; padding: 10px; background: var(--cream); border: 1px dashed var(--gray); min-height: 40px; font-size: 0.85rem;">
                            <span style="color: var(--gray);">No dates selected</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityLocation">Location / Destination</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="activityLocation" placeholder="Boston, Cup Noodles Museum, Croatia" style="flex: 1;">
                            <button type="button" class="secondary" onclick="addLocationTag()" style="white-space: nowrap;">+ Add</button>
                        </div>
                        <div id="locationTags" class="tag-container"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityName">Activity / Activities</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="activityName" placeholder="Nature walk, Salsa dancing, Formal dinner" style="flex: 1;">
                            <button type="button" class="secondary" onclick="addActivityTag()" style="white-space: nowrap;">+ Add</button>
                        </div>
                        <div id="activityTags" class="tag-container"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityDressCode">Dress Code / Requirements</label>
                        <select id="activityDressCode">
                            <option value="activewear">Activewear</option>
                            <option value="everyday-casual">Everyday Casual</option>
                            <option value="dressy-casual">Dressy Casual</option>
                            <option value="formal">Formal / Semi-Formal</option>
                            <option value="beach">Beach / Pool</option>
                            <option value="custom">Custom (specify in notes)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="activityNotes">Activity Notes</label>
                        <textarea id="activityNotes" rows="2" placeholder="Weather considerations, walking distance, special requirements, themes, etc."></textarea>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="primary">+ Add Activity</button>
                        <button type="button" class="secondary" onclick="clearActivityForm()">Clear Form</button>
                    </div>
                </form>
            </div>
            
            <div class="card" id="activitiesListCard" style="display: none;">
                <h2>Your Itinerary</h2>
                <div id="activitiesList"></div>
                
                <div class="button-group" style="margin-top: 30px;">
                    <button class="primary" onclick="continueToWardrobe()">Continue to Wardrobe ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Wardrobe -->
        <div id="wardrobe" class="step">
            <div class="card">
                <h2>Add Wardrobe Items</h2>
                <p>Build your wardrobe inventory with photos and details. Items will be filtered by your color story.</p>
                
                <form id="wardrobeForm" onsubmit="addWardrobeItem(event)">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="itemName">Item Name</label>
                            <input type="text" id="itemName" placeholder="Graphic tee, Wool sweater" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="itemType">Type</label>
                            <select id="itemType" required>
                                <option value="">-- Select type --</option>
                                <option value="top">Top</option>
                                <option value="bottom">Bottom</option>
                                <option value="dress">Dress</option>
                                <option value="jumpsuit">Jumpsuit / Romper</option>
                                <option value="outerwear">Outerwear / Layer</option>
                                <option value="shoes">Shoes</option>
                                <option value="swimwear">Swimwear</option>
                                <option value="activewear-top">Activewear - Top</option>
                                <option value="activewear-bottom">Activewear - Bottom</option>
                                <option value="accessory">Accessory</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemColor">Color(s)</label>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-bottom: 8px;">
                            Select from your color story or add custom colors
                        </div>
                        <div id="itemColorPicker" class="color-palette" style="margin-bottom: 10px;"></div>
                        
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--gray);">
                            <label style="font-size: 0.85rem; margin-bottom: 8px;">Add Custom Color</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="customItemColorName" placeholder="Color name" style="flex: 1;">
                                <input type="color" id="customItemColorValue" value="#000000" style="width: 60px; height: 44px; border: 2px solid var(--dark); cursor: pointer;">
                                <button type="button" class="secondary" onclick="addCustomItemColor()" style="white-space: nowrap;">+ Add</button>
                            </div>
                        </div>
                        
                        <div id="itemColorTags" class="tag-container"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemPhoto">Photo (Optional)</label>
                        <input type="file" id="itemPhoto" accept="image/*" onchange="previewPhoto(event)">
                        <div id="photoPreview" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemNotes">Notes (Optional)</label>
                        <textarea id="itemNotes" rows="2" placeholder="Pattern, fabric, fit notes, etc."></textarea>
                    </div>
                    
                    <div class="button-group">
                        <button type="submit" class="primary">+ Add to Wardrobe</button>
                        <button type="button" class="secondary" onclick="clearWardrobeForm()">Clear Form</button>
                    </div>
                </form>
            </div>
            
            <div class="card" id="wardrobeListCard" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Your Wardrobe</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label for="filterType" style="font-size: 0.85rem; margin: 0;">Filter:</label>
                        <select id="filterType" onchange="renderWardrobeList()" style="width: auto; padding: 8px;">
                            <option value="all">All Items</option>
                            <option value="top">Tops</option>
                            <option value="bottom">Bottoms</option>
                            <option value="dress">Dresses</option>
                            <option value="jumpsuit">Jumpsuits</option>
                            <option value="outerwear">Outerwear</option>
                            <option value="shoes">Shoes</option>
                            <option value="swimwear">Swimwear</option>
                            <option value="activewear-top">Activewear Tops</option>
                            <option value="activewear-bottom">Activewear Bottoms</option>
                            <option value="accessory">Accessories</option>
                        </select>
                    </div>
                </div>
                <div id="wardrobeGrid"></div>
                
                <div class="button-group" style="margin-top: 30px;">
                    <button class="primary" onclick="continueToOutfits()">Continue to Outfits ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Step 4: Outfits -->
        <div id="outfits" class="step">
            <div class="card">
                <h2>Plan Your Outfits</h2>
                <p>Assign wardrobe items to each activity. Click an activity, then click items to add them.</p>
                
                <!-- Outfit Preview -->
                <div id="outfitPreview" style="display: none; margin: 20px 0; padding: 20px; background: var(--cream); border: 2px solid var(--dark);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="font-family: 'Crimson Pro', serif; font-size: 1.2rem; margin: 0;">Outfit Preview</h3>
                        <div style="display: flex; gap: 10px;">
                            <button class="secondary" onclick="togglePreviewMode('selected')" id="previewSelectedBtn" style="font-size: 0.8rem;">Selected Only</button>
                            <button class="secondary" onclick="togglePreviewMode('all')" id="previewAllBtn" style="font-size: 0.8rem;">View All Outfits</button>
                        </div>
                    </div>
                    <div id="outfitPreviewItems"></div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                    <!-- Left: Activities -->
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="font-family: 'Crimson Pro', serif; font-size: 1.3rem; margin: 0;">Activities</h3>
                            <button class="secondary" onclick="suggestAllOutfits()" style="font-size: 0.8rem;">Suggest All Outfits</button>
                        </div>
                        <div id="outfitActivitiesList"></div>
                    </div>
                    
                    <!-- Right: Wardrobe -->
                    <div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="font-family: 'Crimson Pro', serif; font-size: 1.3rem; margin: 0;">Wardrobe</h3>
                            <select id="outfitWardrobeFilter" onchange="renderOutfitWardrobe()" style="width: auto; padding: 8px;">
                                <option value="all">All Items</option>
                                <option value="top">Tops</option>
                                <option value="bottom">Bottoms</option>
                                <option value="dress">Dresses</option>
                                <option value="jumpsuit">Jumpsuits</option>
                                <option value="outerwear">Outerwear</option>
                                <option value="shoes">Shoes</option>
                                <option value="swimwear">Swimwear</option>
                                <option value="activewear-top">Activewear Tops</option>
                                <option value="activewear-bottom">Activewear Bottoms</option>
                                <option value="accessory">Accessories</option>
                            </select>
                        </div>
                        <div id="outfitWardrobeGrid"></div>
                    </div>
                </div>
                
                <div class="button-group" style="margin-top: 30px;">
                    <button class="primary" onclick="continueToExport()">Continue to Export ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Step 5: Export -->
        <div id="export" class="step">
            <div class="card">
                <h2>Trip Summary & Packing Checklist</h2>
                <p>Review your complete trip plan and print your packing checklist.</p>
                
                <div class="button-group" style="margin-top: 20px;">
                    <button class="primary" onclick="printChecklist()">üñ®Ô∏è Print Packing Checklist</button>
                </div>
            </div>
            
            <!-- Trip Summary -->
            <div class="card" id="tripSummaryCard">
                <h2>Trip Summary</h2>
                <div id="tripSummaryContent"></div>
            </div>
            
            <!-- Daily Outfits -->
            <div class="card" id="dailyOutfitsCard">
                <h2>Daily Outfit Plan</h2>
                <div id="dailyOutfitsContent"></div>
            </div>
            
            <!-- Wardrobe Summary -->
            <div class="card" id="wardrobeSummaryCard">
                <h2>Wardrobe Summary</h2>
                <div id="wardrobeSummaryContent"></div>
            </div>
            
            <!-- Hidden printable checklist -->
            <div id="printableChecklist" style="display: none;">
                <style media="print">
                    @page { margin: 1in; }
                    body { font-family: Arial, sans-serif; }
                    .checklist-header { text-align: center; margin-bottom: 30px; }
                    .checklist-section { margin-bottom: 20px; page-break-inside: avoid; }
                    .checklist-section h3 { border-bottom: 2px solid #000; padding-bottom: 5px; }
                    .checklist-item { margin: 8px 0; font-size: 14px; }
                    input[type="checkbox"] { margin-right: 10px; }
                </style>
                <div class="checklist-header">
                    <h1 id="checklistTitle"></h1>
                    <p id="checklistDates"></p>
                </div>
                <div id="checklistContent"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Color season palettes
        const colorSeasons = {
            'cool-summer': [
                { name: 'Soft White', hex: '#f5f5f0' },
                { name: 'Rose Pink', hex: '#e6b8c0' },
                { name: 'Lavender', hex: '#c5b4e3' },
                { name: 'Powder Blue', hex: '#b3d9e6' },
                { name: 'Soft Teal', hex: '#7eb8b0' },
                { name: 'Cocoa', hex: '#9b8b7e' },
                { name: 'Navy', hex: '#3d5a80' },
                { name: 'Charcoal', hex: '#52575d' },
                { name: 'Mauve', hex: '#c197a6' },
                { name: 'Seafoam', hex: '#9dc3c1' },
                { name: 'Dusty Purple', hex: '#8b7f99' },
                { name: 'Cool Gray', hex: '#a8a8a8' }
            ],
            'warm-spring': [
                { name: 'Cream', hex: '#fef9e7' },
                { name: 'Peach', hex: '#ffc5a1' },
                { name: 'Coral', hex: '#ff7f7f' },
                { name: 'Golden Yellow', hex: '#ffd93d' },
                { name: 'Warm Teal', hex: '#4fd1c5' },
                { name: 'Camel', hex: '#c19a6b' },
                { name: 'Warm Navy', hex: '#2c5f7c' },
                { name: 'Bright Green', hex: '#7fb069' },
                { name: 'Apricot', hex: '#ffb380' },
                { name: 'Turquoise', hex: '#40e0d0' },
                { name: 'Warm Brown', hex: '#8b5a3c' },
                { name: 'Ivory', hex: '#fffff0' }
            ],
            'soft-autumn': [
                { name: 'Oyster', hex: '#e8dcc4' },
                { name: 'Dusty Rose', hex: '#c9a9a6' },
                { name: 'Sage Green', hex: '#9caf88' },
                { name: 'Soft Gold', hex: '#d4a574' },
                { name: 'Muted Teal', hex: '#7fa99b' },
                { name: 'Taupe', hex: '#b38b6d' },
                { name: 'Forest Green', hex: '#4a5f54' },
                { name: 'Burgundy', hex: '#8b4049' },
                { name: 'Olive', hex: '#6b7353' },
                { name: 'Brick Red', hex: '#a0522d' },
                { name: 'Coffee', hex: '#6f4e37' },
                { name: 'Stone', hex: '#9e9e9e' }
            ],
            'deep-winter': [
                { name: 'Pure White', hex: '#ffffff' },
                { name: 'Hot Pink', hex: '#ff69b4' },
                { name: 'Royal Purple', hex: '#7851a9' },
                { name: 'Bright Blue', hex: '#0066cc' },
                { name: 'Emerald', hex: '#50c878' },
                { name: 'Black', hex: '#000000' },
                { name: 'True Red', hex: '#e60000' },
                { name: 'Navy', hex: '#000080' },
                { name: 'Magenta', hex: '#ff00ff' },
                { name: 'Pine Green', hex: '#01796f' },
                { name: 'Charcoal', hex: '#36454f' },
                { name: 'Burgundy', hex: '#800020' }
            ],
            'clear-winter': [
                { name: 'Icy White', hex: '#f0f8ff' },
                { name: 'True Pink', hex: '#ffc0cb' },
                { name: 'Violet', hex: '#8f00ff' },
                { name: 'Bright Blue', hex: '#0080ff' },
                { name: 'Emerald Green', hex: '#00c957' },
                { name: 'Black', hex: '#000000' },
                { name: 'Cherry Red', hex: '#de3163' },
                { name: 'Royal Blue', hex: '#002fa7' },
                { name: 'Fuchsia', hex: '#ff00ff' },
                { name: 'Lemon Yellow', hex: '#fff44f' },
                { name: 'Charcoal', hex: '#36454f' },
                { name: 'True Red', hex: '#ff0000' }
            ],
            'warm-autumn': [
                { name: 'Cream', hex: '#fff8dc' },
                { name: 'Rust', hex: '#b7410e' },
                { name: 'Terracotta', hex: '#e2725b' },
                { name: 'Golden Orange', hex: '#ff8c00' },
                { name: 'Olive Green', hex: '#556b2f' },
                { name: 'Warm Brown', hex: '#7b3f00' },
                { name: 'Teal', hex: '#008080' },
                { name: 'Mustard', hex: '#ffdb58' },
                { name: 'Burnt Orange', hex: '#cc5500' },
                { name: 'Moss Green', hex: '#8a9a5b' },
                { name: 'Bronze', hex: '#cd7f32' },
                { name: 'Caramel', hex: '#c68e17' }
            ],
            'clear-spring': [
                { name: 'Ivory', hex: '#fffff0' },
                { name: 'Coral Pink', hex: '#f88379' },
                { name: 'Bright Coral', hex: '#ff7f50' },
                { name: 'Clear Yellow', hex: '#ffef00' },
                { name: 'Bright Teal', hex: '#00cccc' },
                { name: 'Warm Gray', hex: '#bebebe' },
                { name: 'Apple Green', hex: '#8db600' },
                { name: 'Clear Blue', hex: '#0099ff' },
                { name: 'Bright Orange', hex: '#ff6600' },
                { name: 'Periwinkle', hex: '#ccccff' },
                { name: 'Warm Khaki', hex: '#c3b091' },
                { name: 'Light Navy', hex: '#4169e1' }
            ],
            'soft-summer': [
                { name: 'Soft White', hex: '#f5f5f0' },
                { name: 'Blush Pink', hex: '#ffc0cb' },
                { name: 'Soft Lavender', hex: '#e6e6fa' },
                { name: 'Sky Blue', hex: '#87ceeb' },
                { name: 'Mint', hex: '#98ff98' },
                { name: 'Rose Brown', hex: '#bc8f8f' },
                { name: 'Soft Navy', hex: '#4a5f85' },
                { name: 'Pearl Gray', hex: '#d3d3d3' },
                { name: 'Dusty Pink', hex: '#dcb4bc' },
                { name: 'Soft Teal', hex: '#99c9c1' },
                { name: 'Lilac', hex: '#c8a2c8' },
                { name: 'Cool Beige', hex: '#d4c5b9' }
            ],
            'deep-autumn': [
                { name: 'Cream', hex: '#fffdd0' },
                { name: 'Rust', hex: '#b7410e' },
                { name: 'Deep Teal', hex: '#014d4e' },
                { name: 'Forest Green', hex: '#228b22' },
                { name: 'Burgundy', hex: '#800020' },
                { name: 'Chocolate', hex: '#7b3f00' },
                { name: 'Burnt Orange', hex: '#cc5500' },
                { name: 'Olive', hex: '#808000' },
                { name: 'Deep Purple', hex: '#301934' },
                { name: 'Golden Brown', hex: '#996515' },
                { name: 'Brick Red', hex: '#cb4154' },
                { name: 'Charcoal', hex: '#36454f' }
            ],
            'cool-winter': [
                { name: 'Pure White', hex: '#ffffff' },
                { name: 'Icy Pink', hex: '#ffc0cb' },
                { name: 'Royal Purple', hex: '#7851a9' },
                { name: 'Cool Blue', hex: '#0047ab' },
                { name: 'Emerald', hex: '#50c878' },
                { name: 'Black', hex: '#000000' },
                { name: 'True Red', hex: '#e60000' },
                { name: 'Navy', hex: '#000080' },
                { name: 'Magenta', hex: '#ff00ff' },
                { name: 'Cool Gray', hex: '#8c92ac' },
                { name: 'Burgundy', hex: '#800020' },
                { name: 'Pine Green', hex: '#01796f' }
            ],
            'light-spring': [
                { name: 'Ivory', hex: '#fffff0' },
                { name: 'Light Peach', hex: '#ffcba4' },
                { name: 'Soft Coral', hex: '#ff9999' },
                { name: 'Light Yellow', hex: '#ffffe0' },
                { name: 'Aqua', hex: '#7fffd4' },
                { name: 'Light Camel', hex: '#e0c9a6' },
                { name: 'Light Navy', hex: '#5f7f9f' },
                { name: 'Mint Green', hex: '#98ff98' },
                { name: 'Light Pink', hex: '#ffb6c1' },
                { name: 'Periwinkle', hex: '#ccccff' },
                { name: 'Light Brown', hex: '#b5a074' },
                { name: 'Warm Gray', hex: '#c0c0c0' }
            ],
            'light-summer': [
                { name: 'Soft White', hex: '#f5f5f5' },
                { name: 'Light Rose', hex: '#ffc0cb' },
                { name: 'Lavender', hex: '#e6e6fa' },
                { name: 'Light Blue', hex: '#add8e6' },
                { name: 'Soft Mint', hex: '#c1f0c1' },
                { name: 'Light Cocoa', hex: '#d2b48c' },
                { name: 'Soft Navy', hex: '#6b7f95' },
                { name: 'Light Gray', hex: '#d3d3d3' },
                { name: 'Powder Pink', hex: '#f3c5d0' },
                { name: 'Soft Aqua', hex: '#b0e0e6' },
                { name: 'Light Mauve', hex: '#e0b0ff' },
                { name: 'Pearl', hex: '#eae0c8' }
            ]
        };
        
        // App state
        let appState = {
            colorStory: {
                season: '',
                colors: []
            },
            trip: {
                name: '',
                startDate: '',
                endDate: '',
                notes: '',
                activities: []
            },
            wardrobe: [],
            outfits: []
        };
        
        // Load from localStorage
        function loadState() {
            const saved = localStorage.getItem('capsulePlannerState');
            if (saved) {
                appState = JSON.parse(saved);
                // Restore color story if exists
                if (appState.colorStory.season) {
                    document.getElementById('colorSeason').value = appState.colorStory.season;
                    showSeasonPalette();
                }
                
                // Restore custom colors
                const customList = document.getElementById('customColorsList');
                if (customList && appState.colorStory.colors) {
                    appState.colorStory.colors.forEach(color => {
                        if (color.custom) {
                            const swatch = createColorSwatch(color, 'custom');
                            swatch.classList.add('selected');
                            customList.appendChild(swatch);
                        }
                    });
                }
                
                updateSelectedColorsPreview();
            }
        }
        
        // Save to localStorage
        function saveState() {
            localStorage.setItem('capsulePlannerState', JSON.stringify(appState));
        }
        
        // Navigation
        document.querySelectorAll('nav button').forEach(button => {
            button.addEventListener('click', () => {
                const step = button.dataset.step;
                
                // Update nav
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
                button.classList.add('active');
                
                // Update steps
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.getElementById(step).classList.add('active');
                
                // Refresh data when navigating to specific tabs
                if (step === 'wardrobe') {
                    loadWardrobeData();
                }
                if (step === 'outfits') {
                    loadOutfitData();
                }
                if (step === 'export') {
                    loadExportData();
                }
            });
        });
        
        // Color season selection
        document.getElementById('colorSeason').addEventListener('change', showSeasonPalette);
        
        function showSeasonPalette() {
            const season = document.getElementById('colorSeason').value;
            const paletteDiv = document.getElementById('seasonPalette');
            const colorsDiv = document.getElementById('seasonColors');
            
            if (season && colorSeasons[season]) {
                appState.colorStory.season = season;
                paletteDiv.style.display = 'block';
                colorsDiv.innerHTML = '';
                
                colorSeasons[season].forEach(color => {
                    const swatch = createColorSwatch(color, 'season');
                    colorsDiv.appendChild(swatch);
                });
                
                saveState();
            } else {
                paletteDiv.style.display = 'none';
                appState.colorStory.season = '';
            }
        }
        
        function createColorSwatch(color, type) {
            const swatch = document.createElement('div');
            swatch.className = 'color-swatch';
            swatch.style.backgroundColor = color.hex;
            
            // Check if this color is already selected
            const isSelected = appState.colorStory.colors.some(c => c.hex === color.hex);
            if (isSelected) {
                swatch.classList.add('selected');
            }
            
            swatch.innerHTML = `<span class="color-name">${color.name}</span>`;
            
            swatch.addEventListener('click', () => {
                toggleColorSelection(color, swatch);
            });
            
            return swatch;
        }
        
        function toggleColorSelection(color, swatchElement) {
            const existingIndex = appState.colorStory.colors.findIndex(c => c.hex === color.hex);
            
            if (existingIndex > -1) {
                // Remove color
                appState.colorStory.colors.splice(existingIndex, 1);
                swatchElement.classList.remove('selected');
            } else {
                // Add color
                appState.colorStory.colors.push(color);
                swatchElement.classList.add('selected');
            }
            
            updateSelectedColorsPreview();
            saveState();
        }
        
        function addCustomColor() {
            const name = document.getElementById('customColorName').value.trim();
            const hex = document.getElementById('customColorValue').value;
            
            if (!name) {
                alert('Please enter a color name');
                return;
            }
            
            const color = { name, hex, custom: true };
            appState.colorStory.colors.push(color);
            
            // Clear inputs
            document.getElementById('customColorName').value = '';
            document.getElementById('customColorValue').value = '#000000';
            
            // Add to custom colors list
            const customList = document.getElementById('customColorsList');
            const swatch = createColorSwatch(color, 'custom');
            swatch.classList.add('selected');
            customList.appendChild(swatch);
            
            updateSelectedColorsPreview();
            saveState();
        }
        
        function updateSelectedColorsPreview() {
            const preview = document.getElementById('selectedColorsPreview');
            const list = document.getElementById('selectedColorsList');
            
            if (appState.colorStory.colors.length > 0) {
                preview.style.display = 'block';
                list.innerHTML = '';
                
                appState.colorStory.colors.forEach(color => {
                    const chip = document.createElement('div');
                    chip.className = 'selected-color-chip';
                    chip.innerHTML = `
                        <span class="color-dot" style="background-color: ${color.hex}"></span>
                        <span>${color.name}</span>
                        <span class="remove-color" onclick="removeColor('${color.hex}')">√ó</span>
                    `;
                    list.appendChild(chip);
                });
            } else {
                preview.style.display = 'none';
            }
        }
        
        function removeColor(hex) {
            appState.colorStory.colors = appState.colorStory.colors.filter(c => c.hex !== hex);
            
            // Update swatches
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                if (swatch.style.backgroundColor === hex || 
                    rgbToHex(swatch.style.backgroundColor) === hex) {
                    swatch.classList.remove('selected');
                }
            });
            
            // Remove from custom list if exists
            const customList = document.getElementById('customColorsList');
            if (customList) {
                Array.from(customList.children).forEach(swatch => {
                    if (rgbToHex(swatch.style.backgroundColor) === hex) {
                        swatch.remove();
                    }
                });
            }
            
            updateSelectedColorsPreview();
            saveState();
        }
        
        function clearAllColors() {
            if (!confirm('Clear all colors from your color story? This cannot be undone.')) {
                return;
            }
            
            appState.colorStory.colors = [];
            appState.colorStory.season = '';
            
            // Clear season selection
            document.getElementById('colorSeason').value = '';
            document.getElementById('seasonPalette').style.display = 'none';
            
            // Clear custom colors
            const customList = document.getElementById('customColorsList');
            if (customList) {
                customList.innerHTML = '';
            }
            
            // Clear all selected swatches
            document.querySelectorAll('.color-swatch.selected').forEach(swatch => {
                swatch.classList.remove('selected');
            });
            
            updateSelectedColorsPreview();
            saveState();
        }
        
        function rgbToHex(rgb) {
            const values = rgb.match(/\d+/g);
            if (!values) return rgb;
            return '#' + values.map(x => {
                const hex = parseInt(x).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }
        
        function saveColorStory() {
            if (appState.colorStory.colors.length === 0) {
                alert('Please select at least one color for your color story.');
                return;
            }
            
            // Navigate to trip planning
            document.querySelector('nav button[data-step="trip-planning"]').click();
        }
        
        // Trip Planning Functions
        let selectedDates = [];
        let selectedLocations = [];
        let selectedActivities = [];
        
        function addLocationTag() {
            const input = document.getElementById('activityLocation');
            const location = input.value.trim();
            
            if (!location) return;
            
            if (selectedLocations.includes(location)) {
                alert('This location is already added.');
                return;
            }
            
            selectedLocations.push(location);
            input.value = '';
            renderLocationTags();
        }
        
        function removeLocationTag(location) {
            selectedLocations = selectedLocations.filter(l => l !== location);
            renderLocationTags();
        }
        
        function renderLocationTags() {
            const container = document.getElementById('locationTags');
            
            if (selectedLocations.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = selectedLocations.map(location => `
                <span class="tag">
                    ${location}
                    <span class="remove-tag" onclick="removeLocationTag('${location.replace(/'/g, "\\'")}')">√ó</span>
                </span>
            `).join('');
        }
        
        function addActivityTag() {
            const input = document.getElementById('activityName');
            const activity = input.value.trim();
            
            if (!activity) return;
            
            if (selectedActivities.includes(activity)) {
                alert('This activity is already added.');
                return;
            }
            
            selectedActivities.push(activity);
            input.value = '';
            renderActivityTags();
        }
        
        function removeActivityTag(activity) {
            selectedActivities = selectedActivities.filter(a => a !== activity);
            renderActivityTags();
        }
        
        function renderActivityTags() {
            const container = document.getElementById('activityTags');
            
            if (selectedActivities.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = selectedActivities.map(activity => `
                <span class="tag">
                    ${activity}
                    <span class="remove-tag" onclick="removeActivityTag('${activity.replace(/'/g, "\\'")}')">√ó</span>
                </span>
            `).join('');
        }
        
        function generateDatePicker() {
            const startDate = document.getElementById('tripStart').value;
            const endDate = document.getElementById('tripEnd').value;
            
            if (!startDate || !endDate) {
                document.getElementById('datePickerContainer').innerHTML = 
                    '<p style="color: var(--gray); font-style: italic; padding: 20px; text-align: center;">Please set trip dates first</p>';
                return;
            }
            
            // Parse dates in local timezone to avoid UTC conversion issues
            const start = new Date(startDate + 'T00:00:00');
            const end = new Date(endDate + 'T00:00:00');
            const dates = [];
            
            // Generate all dates in range
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                dates.push(new Date(d));
            }
            
            const container = document.getElementById('datePickerContainer');
            const grid = document.createElement('div');
            grid.className = 'date-grid';
            
            dates.forEach((date, index) => {
                const cell = document.createElement('div');
                cell.className = 'date-cell';
                
                const dayNum = date.getDate();
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                
                cell.innerHTML = `
                    <span class="day-name">Day ${index + 1}</span>
                    <span class="day-num">${dayNum}</span>
                    <span class="day-name">${dayName}</span>
                `;
                
                cell.addEventListener('click', (e) => {
                    toggleDateSelection(date, cell, e);
                });
                
                grid.appendChild(cell);
            });
            
            container.innerHTML = '';
            container.appendChild(grid);
        }
        
        function toggleDateSelection(date, cellElement, event) {
            // Format date as YYYY-MM-DD in local timezone
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            const index = selectedDates.indexOf(dateStr);
            
            if (index > -1) {
                // Deselect
                selectedDates.splice(index, 1);
                cellElement.classList.remove('selected');
            } else {
                // Select
                selectedDates.push(dateStr);
                cellElement.classList.add('selected');
            }
            
            updateSelectedDatesDisplay();
        }
        
        function updateSelectedDatesDisplay() {
            const display = document.getElementById('selectedDatesDisplay');
            
            if (selectedDates.length === 0) {
                display.innerHTML = '<span style="color: var(--gray);">No dates selected</span>';
                return;
            }
            
            // Sort dates
            const sortedDates = [...selectedDates].sort();
            const startDate = new Date(document.getElementById('tripStart').value + 'T00:00:00');
            
            const formatted = sortedDates.map(dateStr => {
                const date = new Date(dateStr + 'T00:00:00');
                const dayNum = Math.floor((date - startDate) / (1000 * 60 * 60 * 24)) + 1;
                const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                const monthDay = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                return `Day ${dayNum} (${dayName}, ${monthDay})`;
            }).join(', ');
            
            display.innerHTML = `<strong>Selected:</strong> ${formatted}`;
        }
        
        function saveTripBasics() {
            const name = document.getElementById('tripName').value.trim();
            const startDate = document.getElementById('tripStart').value;
            const endDate = document.getElementById('tripEnd').value;
            const notes = document.getElementById('tripNotes').value.trim();
            
            if (!name || !startDate || !endDate) {
                alert('Please enter trip name and dates.');
                return;
            }
            
            appState.trip.name = name;
            appState.trip.startDate = startDate;
            appState.trip.endDate = endDate;
            appState.trip.notes = notes;
            
            saveState();
            generateDatePicker();
            alert('Trip info saved! You can now add activities.');
        }
        
        function addActivity(event) {
            event.preventDefault();
            console.log('addActivity called');
            console.log('selectedDates:', selectedDates);
            console.log('selectedActivities:', selectedActivities);
            console.log('selectedLocations:', selectedLocations);
            
            if (selectedDates.length === 0) {
                alert('Please select at least one date.');
                return;
            }
            
            if (selectedActivities.length === 0) {
                alert('Please add at least one activity.');
                return;
            }
            
            const baseActivity = {
                dates: [...selectedDates],
                locations: [...selectedLocations],
                activities: [...selectedActivities],
                dressCode: document.getElementById('activityDressCode').value,
                notes: document.getElementById('activityNotes').value.trim()
            };
            
            // Create activity with multiple dates
            const activity = {
                ...baseActivity,
                id: Date.now()
            };
            
            console.log('Adding activity:', activity);
            appState.trip.activities.push(activity);
            saveState();
            
            clearActivityForm();
            renderActivitiesList();
            console.log('Activity added successfully');
        }
        
        function clearActivityForm() {
            document.getElementById('activityForm').reset();
            selectedDates = [];
            selectedLocations = [];
            selectedActivities = [];
            updateSelectedDatesDisplay();
            renderLocationTags();
            renderActivityTags();
            
            // Clear selected date cells
            document.querySelectorAll('.date-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
        }
        
        function renderActivitiesList() {
            const listCard = document.getElementById('activitiesListCard');
            const listDiv = document.getElementById('activitiesList');
            
            if (appState.trip.activities.length === 0) {
                listCard.style.display = 'none';
                return;
            }
            
            listCard.style.display = 'block';
            
            // Show trip summary if available
            let html = '';
            if (appState.trip.name) {
                const dateRange = formatDateRange(appState.trip.startDate, appState.trip.endDate);
                html += `
                    <div class="trip-summary">
                        <h3>${appState.trip.name}</h3>
                        ${dateRange ? `<p><strong>Dates:</strong> ${dateRange}</p>` : ''}
                        ${appState.trip.notes ? `<p><strong>Notes:</strong> ${appState.trip.notes}</p>` : ''}
                    </div>
                `;
            }
            
            // Render activities
            appState.trip.activities.forEach(activity => {
                const dressCodeLabel = activity.dressCode.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                // Format dates display
                const startDate = new Date(appState.trip.startDate + 'T00:00:00');
                const formattedDates = activity.dates.map(dateStr => {
                    const date = new Date(dateStr + 'T00:00:00');
                    const dayNum = Math.floor((date - startDate) / (1000 * 60 * 60 * 24)) + 1;
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    const monthDay = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    return `Day ${dayNum} (${dayName}, ${monthDay})`;
                }).join(', ');
                
                // Format activities
                const activitiesDisplay = activity.activities.join(' ‚Ä¢ ');
                
                // Format locations
                const locationsDisplay = activity.locations.length > 0 
                    ? `<div class="activity-location">üìç ${activity.locations.join(' ‚Ä¢ ')}</div>` 
                    : '';
                
                html += `
                    <div class="activity-card">
                        <div class="activity-header">
                            <div>
                                <div class="activity-date">${formattedDates}</div>
                            </div>
                            <div class="activity-actions">
                                <button class="icon-button delete" onclick="deleteActivity(${activity.id})" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="activity-title">${activitiesDisplay}</div>
                        ${locationsDisplay}
                        <span class="activity-badge ${activity.dressCode}">${dressCodeLabel}</span>
                        ${activity.notes ? `<div class="activity-notes">${activity.notes}</div>` : ''}
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }
        
        function deleteActivity(id) {
            if (confirm('Delete this activity?')) {
                appState.trip.activities = appState.trip.activities.filter(a => a.id !== id);
                saveState();
                renderActivitiesList();
            }
        }
        
        function continueToWardrobe() {
            console.log('continueToWardrobe called');
            console.log('Activities:', appState.trip.activities.length);
            
            if (appState.trip.activities.length === 0) {
                alert('Please add at least one activity before continuing.');
                return;
            }
            
            const wardrobeButton = document.querySelector('nav button[data-step="wardrobe"]');
            console.log('Wardrobe button:', wardrobeButton);
            
            if (wardrobeButton) {
                wardrobeButton.click();
            } else {
                console.error('Wardrobe navigation button not found!');
            }
        }
        
        // Load trip data on page load
        function loadTripData() {
            if (appState.trip.name) {
                document.getElementById('tripName').value = appState.trip.name;
                document.getElementById('tripStart').value = appState.trip.startDate || '';
                document.getElementById('tripEnd').value = appState.trip.endDate || '';
                document.getElementById('tripNotes').value = appState.trip.notes || '';
                
                // Generate date picker if dates are set
                if (appState.trip.startDate && appState.trip.endDate) {
                    generateDatePicker();
                }
            }
            
            renderActivitiesList();
        }
        
        function formatDateRange(startDate, endDate) {
            if (!startDate || !endDate) return '';
            
            const start = new Date(startDate + 'T00:00:00');
            const end = new Date(endDate + 'T00:00:00');
            
            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const startStr = start.toLocaleDateString('en-US', options);
            const endStr = end.toLocaleDateString('en-US', options);
            
            return `${startStr} - ${endStr}`;
        }
        
        // Wardrobe Functions
        let selectedItemColors = [];
        let itemPhotoData = null;
        
        function initializeItemColorPicker() {
            const picker = document.getElementById('itemColorPicker');
            
            if (appState.colorStory.colors.length === 0) {
                picker.innerHTML = '<p style="color: var(--gray); font-style: italic; text-align: center; padding: 20px;">No color story defined. Go back to Color Story step to add colors.</p>';
                return;
            }
            
            picker.innerHTML = '';
            
            // Show ALL colors from color story (both season and custom)
            appState.colorStory.colors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color.hex;
                swatch.innerHTML = `<span class="color-name">${color.name}</span>`;
                
                // Check if this color is already selected for the current item
                const isSelected = selectedItemColors.some(c => c.hex === color.hex);
                if (isSelected) {
                    swatch.classList.add('selected');
                }
                
                swatch.addEventListener('click', () => {
                    toggleItemColorSelection(color, swatch);
                });
                
                picker.appendChild(swatch);
            });
        }
        
        function addCustomItemColor() {
            const name = document.getElementById('customItemColorName').value.trim();
            const hex = document.getElementById('customItemColorValue').value;
            
            if (!name) {
                alert('Please enter a color name');
                return;
            }
            
            const color = { name, hex, custom: true };
            
            // Add to color story if not already there
            if (!appState.colorStory.colors.some(c => c.hex === hex)) {
                appState.colorStory.colors.push(color);
                saveState();
            }
            
            // Add to selected item colors
            if (!selectedItemColors.some(c => c.hex === hex)) {
                selectedItemColors.push(color);
            }
            
            // Clear inputs
            document.getElementById('customItemColorName').value = '';
            document.getElementById('customItemColorValue').value = '#000000';
            
            // Refresh color picker to show new custom color
            initializeItemColorPicker();
            renderItemColorTags();
        }
        
        function toggleItemColorSelection(color, swatchElement) {
            const existingIndex = selectedItemColors.findIndex(c => c.hex === color.hex);
            
            if (existingIndex > -1) {
                selectedItemColors.splice(existingIndex, 1);
                swatchElement.classList.remove('selected');
            } else {
                selectedItemColors.push(color);
                swatchElement.classList.add('selected');
            }
            
            renderItemColorTags();
        }
        
        function renderItemColorTags() {
            const container = document.getElementById('itemColorTags');
            
            if (selectedItemColors.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = selectedItemColors.map(color => `
                <span class="tag">
                    <span class="color-dot" style="background-color: ${color.hex}; width: 16px; height: 16px; border-radius: 50%; border: 1px solid var(--dark);"></span>
                    ${color.name}
                    <span class="remove-tag" onclick="removeItemColor('${color.hex}')">√ó</span>
                </span>
            `).join('');
        }
        
        function removeItemColor(hex) {
            selectedItemColors = selectedItemColors.filter(c => c.hex !== hex);
            
            // Update swatches
            document.querySelectorAll('#itemColorPicker .color-swatch').forEach(swatch => {
                if (rgbToHex(swatch.style.backgroundColor) === hex) {
                    swatch.classList.remove('selected');
                }
            });
            
            renderItemColorTags();
        }
        
        function previewPhoto(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                itemPhotoData = e.target.result;
                
                const preview = document.getElementById('photoPreview');
                preview.innerHTML = `
                    <div class="photo-preview">
                        <img src="${itemPhotoData}" alt="Preview">
                        <div class="remove-preview" onclick="removePhotoPreview()">√ó</div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }
        
        function removePhotoPreview() {
            itemPhotoData = null;
            document.getElementById('itemPhoto').value = '';
            document.getElementById('photoPreview').innerHTML = '';
        }
        
        function addWardrobeItem(event) {
            event.preventDefault();
            
            if (selectedItemColors.length === 0) {
                alert('Please select at least one color for this item.');
                return;
            }
            
            const item = {
                id: Date.now(),
                name: document.getElementById('itemName').value.trim(),
                type: document.getElementById('itemType').value,
                colors: [...selectedItemColors],
                photo: itemPhotoData,
                notes: document.getElementById('itemNotes').value.trim()
            };
            
            appState.wardrobe.push(item);
            saveState();
            
            clearWardrobeForm();
            renderWardrobeList();
        }
        
        function clearWardrobeForm() {
            document.getElementById('wardrobeForm').reset();
            selectedItemColors = [];
            itemPhotoData = null;
            renderItemColorTags();
            document.getElementById('photoPreview').innerHTML = '';
            
            // Clear selected color swatches
            document.querySelectorAll('#itemColorPicker .color-swatch.selected').forEach(swatch => {
                swatch.classList.remove('selected');
            });
        }
        
        function renderWardrobeList() {
            const listCard = document.getElementById('wardrobeListCard');
            const grid = document.getElementById('wardrobeGrid');
            const filterType = document.getElementById('filterType').value;
            
            if (appState.wardrobe.length === 0) {
                listCard.style.display = 'none';
                return;
            }
            
            listCard.style.display = 'block';
            
            // Filter items
            let items = appState.wardrobe;
            if (filterType !== 'all') {
                items = appState.wardrobe.filter(item => item.type === filterType);
            }
            
            if (items.length === 0) {
                grid.innerHTML = '<div class="empty-wardrobe">No items match this filter.</div>';
                return;
            }
            
            grid.className = 'wardrobe-grid';
            grid.innerHTML = items.map(item => {
                const typeLabel = item.type.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                const photoHTML = item.photo 
                    ? `<img src="${item.photo}" alt="${item.name}">`
                    : '<div class="wardrobe-item-photo">üì∑</div>';
                
                const colorsHTML = item.colors.map(color => 
                    `<div class="wardrobe-color-dot" style="background-color: ${color.hex}" title="${color.name}"></div>`
                ).join('');
                
                return `
                    <div class="wardrobe-item">
                        ${item.photo ? `<div class="wardrobe-item-photo">${photoHTML}</div>` : photoHTML}
                        <div class="wardrobe-item-info">
                            <div class="wardrobe-item-name">${item.name}</div>
                            <div class="wardrobe-item-type">${typeLabel}</div>
                            <div class="wardrobe-item-colors">${colorsHTML}</div>
                            ${item.notes ? `<div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">${item.notes}</div>` : ''}
                            <div class="wardrobe-item-actions">
                                <button onclick="deleteWardrobeItem(${item.id})" class="delete">Delete</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function deleteWardrobeItem(id) {
            if (confirm('Delete this item from your wardrobe?')) {
                appState.wardrobe = appState.wardrobe.filter(item => item.id !== id);
                saveState();
                renderWardrobeList();
            }
        }
        
        function continueToOutfits() {
            if (appState.wardrobe.length === 0) {
                alert('Please add at least one wardrobe item before continuing.');
                return;
            }
            
            document.querySelector('nav button[data-step="outfits"]').click();
        }
        
        // Outfit Planning Functions
        let selectedActivityId = null;
        let previewMode = 'selected'; // 'selected' or 'all'
        
        function togglePreviewMode(mode) {
            previewMode = mode;
            
            // Update button states
            document.getElementById('previewSelectedBtn').style.background = mode === 'selected' ? 'var(--pink)' : 'white';
            document.getElementById('previewSelectedBtn').style.color = mode === 'selected' ? 'white' : 'var(--dark)';
            document.getElementById('previewAllBtn').style.background = mode === 'all' ? 'var(--pink)' : 'white';
            document.getElementById('previewAllBtn').style.color = mode === 'all' ? 'white' : 'var(--dark)';
            
            updateOutfitPreview();
        }
        
        function loadOutfitData() {
            // Initialize outfits array if needed
            if (!appState.outfits) {
                appState.outfits = appState.trip.activities.map(activity => ({
                    activityId: activity.id,
                    items: []
                }));
                saveState();
            }
            
            renderOutfitActivities();
            renderOutfitWardrobe();
        }
        
        function renderOutfitActivities() {
            const list = document.getElementById('outfitActivitiesList');
            
            if (appState.trip.activities.length === 0) {
                list.innerHTML = '<div class="empty-state">No activities planned. Go back to Trip Planning.</div>';
                return;
            }
            
            const startDate = new Date(appState.trip.startDate + 'T00:00:00');
            
            list.innerHTML = appState.trip.activities.map(activity => {
                const isSelected = selectedActivityId === activity.id;
                
                // Format dates
                const formattedDates = activity.dates.map(dateStr => {
                    const date = new Date(dateStr + 'T00:00:00');
                    const dayNum = Math.floor((date - startDate) / (1000 * 60 * 60 * 24)) + 1;
                    return `Day ${dayNum}`;
                }).join(', ');
                
                // Get assigned items for this activity
                const outfit = appState.outfits.find(o => o.activityId === activity.id);
                const assignedItems = outfit ? outfit.items : [];
                
                const itemsHTML = assignedItems.length > 0 ? `
                    <div class="outfit-items-assigned">
                        <div class="outfit-items-assigned-title">Outfit (${assignedItems.length} items)</div>
                        ${assignedItems.map(itemId => {
                            const item = appState.wardrobe.find(w => w.id === itemId);
                            if (!item) return '';
                            
                            const colorsHTML = item.colors.map(color => 
                                `<div class="wardrobe-color-dot" style="background-color: ${color.hex}; width: 12px; height: 12px;" title="${color.name}"></div>`
                            ).join('');
                            
                            return `
                                <div class="outfit-assigned-item">
                                    <div style="display: flex; gap: 6px; align-items: center;">
                                        ${colorsHTML}
                                    </div>
                                    ${item.name}
                                    <span class="remove" onclick="unassignItem(${activity.id}, ${itemId}); event.stopPropagation();">√ó</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : `
                    <div style="margin-top: 10px;">
                        <button class="secondary" onclick="suggestOutfit(${activity.id}); event.stopPropagation();" style="width: 100%; font-size: 0.8rem;">‚ú® Suggest Outfit</button>
                    </div>
                `;
                
                return `
                    <div class="outfit-activity-card ${isSelected ? 'selected' : ''}" onclick="selectActivity(${activity.id})">
                        <div class="outfit-activity-header">${formattedDates}</div>
                        <div class="outfit-activity-title">${activity.activities.join(' ‚Ä¢ ')}</div>
                        ${activity.locations.length > 0 ? `<div style="font-size: 0.8rem; color: var(--teal);">üìç ${activity.locations.join(' ‚Ä¢ ')}</div>` : ''}
                        ${itemsHTML}
                    </div>
                `;
            }).join('');
        }
        
        function selectActivity(activityId) {
            selectedActivityId = activityId;
            renderOutfitActivities();
            updateOutfitPreview();
        }
        
        function updateOutfitPreview() {
            const preview = document.getElementById('outfitPreview');
            const previewItems = document.getElementById('outfitPreviewItems');
            
            if (previewMode === 'selected') {
                if (!selectedActivityId) {
                    preview.style.display = 'none';
                    return;
                }
                
                const outfit = appState.outfits.find(o => o.activityId === selectedActivityId);
                if (!outfit || outfit.items.length === 0) {
                    preview.style.display = 'none';
                    return;
                }
                
                preview.style.display = 'block';
                previewItems.style.display = 'flex';
                previewItems.style.flexWrap = 'wrap';
                previewItems.style.gap = '15px';
                
                previewItems.innerHTML = outfit.items.map(itemId => {
                    const item = appState.wardrobe.find(w => w.id === itemId);
                    if (!item) return '';
                    
                    const photoHTML = item.photo 
                        ? `<img src="${item.photo}" alt="${item.name}">`
                        : 'üì∑';
                    
                    return `
                        <div class="outfit-preview-item">
                            <div class="outfit-preview-photo">${photoHTML}</div>
                            <div class="outfit-preview-name">${item.name}</div>
                        </div>
                    `;
                }).join('');
            } else {
                // Show all outfits
                const hasOutfits = appState.outfits.some(o => o.items.length > 0);
                if (!hasOutfits) {
                    preview.style.display = 'none';
                    return;
                }
                
                preview.style.display = 'block';
                previewItems.style.display = 'block';
                previewItems.className = 'all-outfits-container';
                
                const startDate = new Date(appState.trip.startDate + 'T00:00:00');
                
                previewItems.innerHTML = appState.trip.activities.map(activity => {
                    const outfit = appState.outfits.find(o => o.activityId === activity.id);
                    if (!outfit || outfit.items.length === 0) return '';
                    
                    const formattedDates = activity.dates.map(dateStr => {
                        const date = new Date(dateStr + 'T00:00:00');
                        const dayNum = Math.floor((date - startDate) / (1000 * 60 * 60 * 24)) + 1;
                        return `Day ${dayNum}`;
                    }).join(', ');
                    
                    const itemsHTML = outfit.items.map(itemId => {
                        const item = appState.wardrobe.find(w => w.id === itemId);
                        if (!item) return '';
                        
                        const photoHTML = item.photo 
                            ? `<img src="${item.photo}" alt="${item.name}">`
                            : 'üì∑';
                        
                        return `
                            <div class="outfit-preview-item">
                                <div class="outfit-preview-photo">${photoHTML}</div>
                                <div class="outfit-preview-name">${item.name}</div>
                            </div>
                        `;
                    }).join('');
                    
                    return `
                        <div class="outfit-group">
                            <div class="outfit-group-header">${formattedDates} - ${activity.activities.join(' ‚Ä¢ ')}</div>
                            <div class="outfit-group-items">${itemsHTML}</div>
                        </div>
                    `;
                }).join('');
            }
        }
        
        function renderOutfitWardrobe() {
            const grid = document.getElementById('outfitWardrobeGrid');
            const filter = document.getElementById('outfitWardrobeFilter').value;
            
            if (appState.wardrobe.length === 0) {
                grid.innerHTML = '<div class="empty-wardrobe">No wardrobe items. Go back to Wardrobe.</div>';
                return;
            }
            
            // Filter items
            let items = appState.wardrobe;
            if (filter !== 'all') {
                items = items.filter(item => item.type === filter);
            }
            
            if (items.length === 0) {
                grid.innerHTML = '<div class="empty-wardrobe">No items match this filter.</div>';
                return;
            }
            
            // Calculate usage count for each item
            const usageCounts = {};
            appState.outfits.forEach(outfit => {
                outfit.items.forEach(itemId => {
                    usageCounts[itemId] = (usageCounts[itemId] || 0) + 1;
                });
            });
            
            grid.innerHTML = items.map(item => {
                const typeLabel = item.type.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                const usageCount = usageCounts[item.id] || 0;
                const isAssigned = usageCount > 0;
                
                const photoHTML = item.photo 
                    ? `<img src="${item.photo}" alt="${item.name}">`
                    : 'üì∑';
                
                return `
                    <div class="outfit-wardrobe-item ${isAssigned ? 'assigned' : ''}" onclick="toggleItemAssignment(${item.id})">
                        <div class="outfit-wardrobe-item-photo">${photoHTML}</div>
                        <div class="outfit-wardrobe-item-info">
                            <div class="outfit-wardrobe-item-name">${item.name}</div>
                            <div class="outfit-wardrobe-item-type">${typeLabel}</div>
                            ${usageCount > 0 ? `<div class="outfit-wardrobe-item-usage">Used ${usageCount}x</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function toggleItemAssignment(itemId) {
            if (!selectedActivityId) {
                alert('Please select an activity first.');
                return;
            }
            
            // Find or create outfit for this activity
            let outfit = appState.outfits.find(o => o.activityId === selectedActivityId);
            if (!outfit) {
                outfit = { activityId: selectedActivityId, items: [] };
                appState.outfits.push(outfit);
            }
            
            // Toggle item
            const itemIndex = outfit.items.indexOf(itemId);
            if (itemIndex > -1) {
                outfit.items.splice(itemIndex, 1);
            } else {
                outfit.items.push(itemId);
            }
            
            saveState();
            renderOutfitActivities();
            renderOutfitWardrobe();
            updateOutfitPreview();
        }
        
        function unassignItem(activityId, itemId) {
            const outfit = appState.outfits.find(o => o.activityId === activityId);
            if (outfit) {
                outfit.items = outfit.items.filter(id => id !== itemId);
                saveState();
                renderOutfitActivities();
                renderOutfitWardrobe();
                updateOutfitPreview();
            }
        }
        
        // Outfit Suggestion Logic
        function suggestOutfit(activityId) {
            const activity = appState.trip.activities.find(a => a.id === activityId);
            if (!activity) return;
            
            const dressCode = activity.dressCode;
            const suggestedItems = generateOutfitForDressCode(dressCode);
            
            if (suggestedItems.length === 0) {
                alert('Could not generate outfit - may need more wardrobe items for this dress code.');
                return;
            }
            
            // Assign suggested items
            let outfit = appState.outfits.find(o => o.activityId === activityId);
            if (!outfit) {
                outfit = { activityId: activityId, items: [] };
                appState.outfits.push(outfit);
            }
            
            outfit.items = suggestedItems;
            saveState();
            renderOutfitActivities();
            renderOutfitWardrobe();
            updateOutfitPreview();
        }
        
        function suggestAllOutfits() {
            if (!confirm('Generate outfit suggestions for all activities? This will replace existing outfits.')) {
                return;
            }
            
            appState.trip.activities.forEach(activity => {
                suggestOutfit(activity.id);
            });
        }
        
        function generateOutfitForDressCode(dressCode) {
            const items = [];
            
            // Calculate current usage to prefer less-used items
            const usageCounts = {};
            appState.outfits.forEach(outfit => {
                outfit.items.forEach(itemId => {
                    usageCounts[itemId] = (usageCounts[itemId] || 0) + 1;
                });
            });
            
            // Helper to get least-used item of a type
            const getLeastUsedItem = (type) => {
                const itemsOfType = appState.wardrobe.filter(item => item.type === type);
                if (itemsOfType.length === 0) return null;
                
                // Sort by usage count (ascending)
                itemsOfType.sort((a, b) => (usageCounts[a.id] || 0) - (usageCounts[b.id] || 0));
                
                // Get items with the lowest usage count
                const minUsage = usageCounts[itemsOfType[0].id] || 0;
                const leastUsed = itemsOfType.filter(item => (usageCounts[item.id] || 0) === minUsage);
                
                // Randomly pick from least-used options to distribute usage
                return leastUsed[Math.floor(Math.random() * leastUsed.length)];
            };
            
            // Helper to get random least-used item from multiple types
            // This one adds MORE randomness - picks randomly from top 3 least-used tiers
            const getLeastUsedFromTypes = (types) => {
                const candidates = [];
                types.forEach(type => {
                    const itemsOfType = appState.wardrobe.filter(item => item.type === type);
                    candidates.push(...itemsOfType);
                });
                if (candidates.length === 0) return null;
                
                // Sort by usage
                candidates.sort((a, b) => (usageCounts[a.id] || 0) - (usageCounts[b.id] || 0));
                
                // Instead of just picking from minUsage tier, pick from bottom 50% randomly
                const halfPoint = Math.ceil(candidates.length / 2);
                const lessUsedHalf = candidates.slice(0, halfPoint);
                
                return lessUsedHalf[Math.floor(Math.random() * lessUsedHalf.length)];
            };
            
            // Helper to randomly decide between dress and top+bottom
            const shouldUseDress = () => {
                return Math.random() < 0.6; // 60% chance of dress if available
            };
            
            switch(dressCode) {
                case 'activewear':
                    // Activewear top + activewear bottom + shoes
                    const activeTop = getLeastUsedItem('activewear-top');
                    const activeBottom = getLeastUsedItem('activewear-bottom');
                    const activeShoes = getLeastUsedFromTypes(['shoes']);
                    
                    if (activeTop) items.push(activeTop.id);
                    if (activeBottom) items.push(activeBottom.id);
                    if (activeShoes) items.push(activeShoes.id);
                    break;
                    
                case 'beach':
                    // Swimwear + optional shoes
                    const swimwear = getLeastUsedItem('swimwear');
                    const beachShoes = getLeastUsedFromTypes(['shoes']);
                    
                    if (swimwear) items.push(swimwear.id);
                    if (beachShoes) items.push(beachShoes.id);
                    break;
                    
                case 'formal':
                    // Dress OR (top + bottom) + shoes + optional outerwear
                    // For formal, prefer dresses over jumpsuits (jumpsuits might be casual overalls)
                    const formalDress = getLeastUsedItem('dress');
                    
                    if (formalDress && shouldUseDress()) {
                        items.push(formalDress.id);
                    } else {
                        // Try jumpsuit only if no dress available (and avoid ones with "overall" in name)
                        const jumpsuits = appState.wardrobe.filter(item => 
                            item.type === 'jumpsuit' && 
                            !item.name.toLowerCase().includes('overall')
                        );
                        
                        const shouldTryJumpsuit = Math.random() < 0.3; // Only 30% chance
                        
                        if (jumpsuits.length > 0 && shouldTryJumpsuit && !formalDress) {
                            jumpsuits.sort((a, b) => (usageCounts[a.id] || 0) - (usageCounts[b.id] || 0));
                            const minUsage = usageCounts[jumpsuits[0].id] || 0;
                            const leastUsed = jumpsuits.filter(item => (usageCounts[item.id] || 0) === minUsage);
                            const selectedJumpsuit = leastUsed[Math.floor(Math.random() * leastUsed.length)];
                            items.push(selectedJumpsuit.id);
                        } else {
                            // Fall back to top + bottom
                            const formalTop = getLeastUsedItem('top');
                            const formalBottom = getLeastUsedItem('bottom');
                            if (formalTop) items.push(formalTop.id);
                            if (formalBottom) items.push(formalBottom.id);
                        }
                    }
                    
                    const formalShoes = getLeastUsedItem('shoes');
                    const formalLayer = getLeastUsedItem('outerwear');
                    
                    if (formalShoes) items.push(formalShoes.id);
                    if (formalLayer) items.push(formalLayer.id);
                    break;
                    
                case 'dressy-casual':
                    // Top + bottom OR dress/jumpsuit + shoes + optional layer
                    // Avoid casual overalls for dressy-casual
                    const dressyDress = getLeastUsedItem('dress');
                    const dressyOptions = appState.wardrobe.filter(item => 
                        item.type === 'jumpsuit' &&
                        !item.name.toLowerCase().includes('overall')
                    );
                    
                    const useDressyDress = dressyDress && shouldUseDress();
                    const useDressyJumpsuit = dressyOptions.length > 0 && Math.random() < 0.25; // 25% chance
                    
                    if (useDressyDress) {
                        items.push(dressyDress.id);
                    } else if (useDressyJumpsuit && !useDressyDress) {
                        dressyOptions.sort((a, b) => (usageCounts[a.id] || 0) - (usageCounts[b.id] || 0));
                        const minUsage = usageCounts[dressyOptions[0].id] || 0;
                        const leastUsed = dressyOptions.filter(item => (usageCounts[item.id] || 0) === minUsage);
                        const selected = leastUsed[Math.floor(Math.random() * leastUsed.length)];
                        items.push(selected.id);
                    } else {
                        const casualTop = getLeastUsedItem('top');
                        const casualBottom = getLeastUsedItem('bottom');
                        if (casualTop) items.push(casualTop.id);
                        if (casualBottom) items.push(casualBottom.id);
                    }
                    
                    const casualShoes = getLeastUsedItem('shoes');
                    if (casualShoes) items.push(casualShoes.id);
                    break;
                    
                case 'everyday-casual':
                default:
                    // Top + bottom OR dress/jumpsuit + shoes
                    // Can mix activewear with regular for casual
                    const everydayDress = getLeastUsedItem('dress');
                    const everydayJumpsuit = getLeastUsedFromTypes(['jumpsuit']);
                    
                    const useEverydayDress = everydayDress && Math.random() < 0.4; // 40% chance
                    const useEverydayJumpsuit = everydayJumpsuit && Math.random() < 0.3; // 30% chance
                    
                    if (useEverydayDress) {
                        items.push(everydayDress.id);
                    } else if (useEverydayJumpsuit && !useEverydayDress) {
                        items.push(everydayJumpsuit.id);
                    } else {
                        const everydayTop = getLeastUsedFromTypes(['top', 'activewear-top']);
                        const everydayBottom = getLeastUsedFromTypes(['bottom', 'activewear-bottom']);
                        if (everydayTop) items.push(everydayTop.id);
                        if (everydayBottom) items.push(everydayBottom.id);
                    }
                    
                    const everydayShoes = getLeastUsedItem('shoes');
                    if (everydayShoes) items.push(everydayShoes.id);
                    break;
            }
            
            return items.filter(id => id !== null && id !== undefined);
        }
        
        function continueToExport() {
            document.querySelector('nav button[data-step="export"]').click();
        }
        
        // Export Functions
        function loadExportData() {
            renderTripSummary();
            renderDailyOutfits();
            renderWardrobeSummary();
        }
        
        function renderTripSummary() {
            const content = document.getElementById('tripSummaryContent');
            
            let html = '';
            
            if (appState.trip.name) {
                html += `<div class="summary-row">
                    <div class="summary-label">Trip Name</div>
                    <div class="summary-value">${appState.trip.name}</div>
                </div>`;
            }
            
            if (appState.trip.startDate && appState.trip.endDate) {
                const dateRange = formatDateRange(appState.trip.startDate, appState.trip.endDate);
                html += `<div class="summary-row">
                    <div class="summary-label">Dates</div>
                    <div class="summary-value">${dateRange}</div>
                </div>`;
            }
            
            if (appState.trip.notes) {
                html += `<div class="summary-row">
                    <div class="summary-label">Notes</div>
                    <div class="summary-value">${appState.trip.notes}</div>
                </div>`;
            }
            
            if (appState.colorStory.colors.length > 0) {
                const colorChips = appState.colorStory.colors.map(color => `
                    <span class="selected-color-chip">
                        <span class="color-dot" style="background-color: ${color.hex}"></span>
                        ${color.name}
                    </span>
                `).join('');
                
                html += `<div class="summary-row">
                    <div class="summary-label">Color Story</div>
                    <div class="summary-value" style="display: flex; flex-wrap: wrap; gap: 8px;">${colorChips}</div>
                </div>`;
            }
            
            html += `<div class="summary-row">
                <div class="summary-label">Activities</div>
                <div class="summary-value">${appState.trip.activities.length} planned</div>
            </div>`;
            
            html += `<div class="summary-row">
                <div class="summary-label">Wardrobe Items</div>
                <div class="summary-value">${appState.wardrobe.length} pieces</div>
            </div>`;
            
            content.innerHTML = html;
        }
        
        function renderDailyOutfits() {
            const content = document.getElementById('dailyOutfitsContent');
            
            if (appState.trip.activities.length === 0) {
                content.innerHTML = '<p style="color: var(--gray); font-style: italic;">No activities planned.</p>';
                return;
            }
            
            const startDate = new Date(appState.trip.startDate + 'T00:00:00');
            
            content.innerHTML = appState.trip.activities.map(activity => {
                const formattedDates = activity.dates.map(dateStr => {
                    const date = new Date(dateStr + 'T00:00:00');
                    const dayNum = Math.floor((date - startDate) / (1000 * 60 * 60 * 24)) + 1;
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                    return `Day ${dayNum} - ${dayName}`;
                }).join(', ');
                
                const outfit = appState.outfits.find(o => o.activityId === activity.id);
                const dressCodeLabel = activity.dressCode.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                let outfitHTML = '';
                if (outfit && outfit.items.length > 0) {
                    outfitHTML = `
                        <div class="daily-outfit-items">
                            ${outfit.items.map(itemId => {
                                const item = appState.wardrobe.find(w => w.id === itemId);
                                if (!item) return '';
                                
                                const photoHTML = item.photo 
                                    ? `<img src="${item.photo}" alt="${item.name}">`
                                    : 'üì∑';
                                
                                return `
                                    <div class="outfit-preview-item">
                                        <div class="outfit-preview-photo">${photoHTML}</div>
                                        <div class="outfit-preview-name">${item.name}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } else {
                    outfitHTML = '<p style="color: var(--gray); font-style: italic; margin-top: 10px;">No outfit planned</p>';
                }
                
                return `
                    <div class="daily-outfit-card">
                        <div class="daily-outfit-date">${formattedDates}</div>
                        <div class="daily-outfit-activity">${activity.activities.join(' ‚Ä¢ ')}</div>
                        ${activity.locations.length > 0 ? `<div style="color: var(--teal); font-size: 0.9rem;">üìç ${activity.locations.join(' ‚Ä¢ ')}</div>` : ''}
                        <div style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;"><strong>Dress Code:</strong> ${dressCodeLabel}</div>
                        ${activity.notes ? `<div style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;"><strong>Notes:</strong> ${activity.notes}</div>` : ''}
                        ${outfitHTML}
                    </div>
                `;
            }).join('');
        }
        
        function renderWardrobeSummary() {
            const content = document.getElementById('wardrobeSummaryContent');
            
            // Calculate usage
            const usageCounts = {};
            appState.outfits.forEach(outfit => {
                outfit.items.forEach(itemId => {
                    usageCounts[itemId] = (usageCounts[itemId] || 0) + 1;
                });
            });
            
            const usedOnce = [];
            const usedTwice = [];
            const usedMultiple = [];
            const unused = [];
            
            appState.wardrobe.forEach(item => {
                const count = usageCounts[item.id] || 0;
                if (count === 0) unused.push(item.name);
                else if (count === 1) usedOnce.push(item.name);
                else if (count === 2) usedTwice.push(item.name);
                else usedMultiple.push(`${item.name} (${count}x)`);
            });
            
            content.innerHTML = `
                <div class="usage-summary">
                    ${usedMultiple.length > 0 ? `
                        <div class="usage-category" style="background: rgba(78, 205, 196, 0.1); border-color: var(--teal);">
                            <h4>Workhorse Pieces (3+ uses)</h4>
                            <ul>${usedMultiple.map(name => `<li>${name}</li>`).join('')}</ul>
                        </div>
                    ` : ''}
                    
                    ${usedTwice.length > 0 ? `
                        <div class="usage-category">
                            <h4>Used Twice</h4>
                            <ul>${usedTwice.map(name => `<li>${name}</li>`).join('')}</ul>
                        </div>
                    ` : ''}
                    
                    ${usedOnce.length > 0 ? `
                        <div class="usage-category">
                            <h4>Used Once</h4>
                            <ul>${usedOnce.map(name => `<li>${name}</li>`).join('')}</ul>
                        </div>
                    ` : ''}
                    
                    ${unused.length > 0 ? `
                        <div class="usage-category" style="background: rgba(255, 107, 157, 0.1); border-color: var(--pink);">
                            <h4>Backup / Unused</h4>
                            <ul>${unused.map(name => `<li>${name}</li>`).join('')}</ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function printChecklist() {
            // Generate checklist content
            const checklistContent = document.getElementById('checklistContent');
            const checklistTitle = document.getElementById('checklistTitle');
            const checklistDates = document.getElementById('checklistDates');
            
            checklistTitle.textContent = `Packing Checklist: ${appState.trip.name || 'Trip'}`;
            
            if (appState.trip.startDate && appState.trip.endDate) {
                checklistDates.textContent = formatDateRange(appState.trip.startDate, appState.trip.endDate);
            }
            
            // Group items by type
            const itemsByType = {};
            appState.wardrobe.forEach(item => {
                if (!itemsByType[item.type]) {
                    itemsByType[item.type] = [];
                }
                itemsByType[item.type].push(item);
            });
            
            const typeOrder = {
                'top': 'Tops',
                'bottom': 'Bottoms',
                'dress': 'Dresses',
                'jumpsuit': 'Jumpsuits / Rompers',
                'outerwear': 'Outerwear / Top Layers',
                'shoes': 'Shoes',
                'swimwear': 'Swimwear',
                'activewear-top': 'Activewear Tops',
                'activewear-bottom': 'Activewear Bottoms',
                'accessory': 'Accessories'
            };
            
            let html = '';
            Object.keys(typeOrder).forEach(type => {
                if (itemsByType[type] && itemsByType[type].length > 0) {
                    html += `
                        <div class="checklist-section">
                            <h3>${typeOrder[type]} (${itemsByType[type].length})</h3>
                            ${itemsByType[type].map(item => `
                                <div class="checklist-item">
                                    <input type="checkbox"> ${item.name}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });
            
            checklistContent.innerHTML = html;
            
            // Print
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(document.getElementById('printableChecklist').innerHTML);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Load wardrobe on page load
        function loadWardrobeData() {
            initializeItemColorPicker();
            renderWardrobeList();
        }
        
        // Initialize
        loadState();
        loadTripData();
        loadWardrobeData();
        
        // Allow Enter key to add tags
        document.getElementById('activityLocation').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addLocationTag();
            }
        });
        
        document.getElementById('activityName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                addActivityTag();
            }
        });
    </script>
</body>
</html>
